<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Go-dependency-force-layout : " />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Go-dependency-force-layout</title>

    <script type="text/javascript">var _kmq = _kmq || [];
var _kmk = _kmk || 'aa39636d3aa5aaa08a53bc23db58e885311f83cb';
function _kms(u){
  setTimeout(function(){
    var d = document, f = d.getElementsByTagName('script')[0],
    s = d.createElement('script');
    s.type = 'text/javascript'; s.async = true; s.src = u;
    f.parentNode.insertBefore(s, f);
  }, 1);
}
_kms('//i.kissmetrics.com/i.js');
_kms('//doug1izaerwt3.cloudfront.net/' + _kmk + '.1.js');
</script>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/mrmanc/go-dependency-force-layout">View on GitHub</a>

          <h1 id="project_title">Go-dependency-force-layout</h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/mrmanc/go-dependency-force-layout/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/mrmanc/go-dependency-force-layout/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
<p>This is a tool to visualise the web of dependencies present in a large configuration of <a href="http://www.thoughtworks.com/products/go-continuous-delivery">ThoughtWorks’ Go system for continuous delivery</a>.</p>

<p><a href="pipeline-dependencies.html?u=examples/27012014.json">Skip to an example built from our pipeline definitions.</a><p/>

<p><img src="readmeimages/large.jpg" alt="Larger example graph" title="Larger example graph"></p>

<p><img src="readmeimages/sample.png" alt="Example graph" title="Example graph" style="float: right;"><img src="readmeimages/pipeline.png" alt="circle" title="circle"> Circles represent pipelines<br />
<img src="readmeimages/template.png" alt="square" title="square"> squares represent pipeline templates<br />
<img src="readmeimages/source.png" alt="triangle" title="triangle"> triangles represent source code repositories.
</p>

<p>Arrows represent dependencies and the size of each shape grows with more incoming dependencies. Pipelines in the same groups are coloured similarly.</p>

<p>It uses the excellent work of Mike Bostock on <a href="http://d3js.org/">D3.js</a>, adapted from a number of <a href="http://bl.ocks.org/mbostock">his examples</a> (e.g. <a href="http://bl.ocks.org/mbostock/4062045">http://bl.ocks.org/mbostock/4062045</a>).</p>

<p>It works by fetching the configuration XML over HTTP, either from the <a href="http://www.thoughtworks.com/products/docs/go/current/help/Configuration_API.html">Configuration API</a> (provided you are a logged in Go Admin) or from a supplied URL. It then extracts the declared dependencies into JSON and passes this to D3.js to be displayed as SVG.</p>

<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting Started</h2>

<p>Use the <a href="pipeline-dependencies.html">hosted HTML page</a> to explore your dependencies. It can build the graph in three ways: fetching and parsing the XML, using graph data encoded into the URL or from a generated JSON file hosted remotely. Here are instructions (with the easiest first):</p>

<h3>Paste in your XML</h3>

<p>If you scroll down there’s a text box you can paste your XML in to. Click load, and your graph will be built from the source. You can't save the JSON at the moment, or share the chart generated (watch this space).</p>

<h3>Sharing graphs as URLs</h3>

Once you've built the graph, a link will appear at the top right which contains the JSON metadata compressed and encoded. For large graphs the compressed data may be too large for some browsers to show, so I've set a hard limit of 10k characters (the limit of Chrome's omnibox) beyond which you’ll see message suggesting you try hiding labels. With the labels hidden the link it generates will not contain the labels, so is safe to share with the public.

<h3>Fetching XML from Go</h3>

<p>Simply point to the configuration XML by supplying a configUrl parameter like this:</p>

<pre><code>http://localhost:8081/pipeline-dependencies.html?configUrl=http://yourgoserver/go/admin/config_xml
</code></pre>

<p>Since it makes cross origin requests, you'll need to make sure the target server (Go / JSON location) authorises this page as an origin, using the <code>Access-Control-Allow-Origin: http://mrmanc.github.io</code> header.<p>

<p>You’ll also need to issue the <code>Access-Control-Allow-Credentials: true</code> header from your Go instance to ensure your browser is allowed to send your cookie credentials to Go (as fetching config is privilidged). <a href="http://enable-cors.org/server_apache.html">Read more about Cross Origin Resource Sharing</a></p>

<h3>Loading graphs from JSON files</h3>

<p>If you have problems with long URLs you may wish to load the graph data from JSON. Currently you’ll need to do this by hosting the JSON file somewhere and telling the page where to find it, by supplying it’s address as a parameter called ‘u’ like this: <code>http://mrmanc.github.io/go-dependency-force-layout/pipeline-dependencies.html?u=http://mrmanc.github.io/go-dependency-force-layout/examples/27012014.json</code>.</p>

<p>Your JSON location will need to issue the <code>Access-Control-Allow-Origin: http://mrmanc.github.io</code> header. At some point I will make it possible to save the JSON generated by the page, and load graphs without hosting JSON files remotely.</p>

<h2>Hosting your own HTML</h2>

<p>If you want to clone the project and use the page offline, or you don’t want to fiddle with cross origin headers, you’ll need to start a local web server. Using a file:// url will not work. A shell script is included to quickly get a server running using Python: see <a href="start-http-server.sh">start-http-server.sh</a>.</p>

<p>The tool will default to the included <a href="sample.xml">sample.xml</a> if you do not supply the parameter, to give you an idea of how it works.</p>

<h2>
<a name="why" class="anchor" href="#why"><span class="octicon octicon-link"></span></a>Why do this?</h2>

<p>I built this to see if it could help me understand how our organisation was using Go, and it proved very enlightening.</p>

<p>I also found it interesting to look at previous historical versions of the configuration, which you can get at using the <a href="http://www.thoughtworks.com/products/docs/go/current/help/Configuration_API.html">Go configuration API</a> provided you know the MD5 hash. If you don't, you can use git to query the configuration git repository on the server itself, using something like this:</p>

<pre><code>git --git-dir=/data/go/db/config.git/.git/ log | tail -100
</code></pre>

<p>You can only go back as far as your upgrade to v2.2 though as that is when version control was brought in.</p>

<p>If, like me, yours does not fit on the screen, hit zoom out a few times and refresh the page.</p>

<p><a href="http://mrmanc.github.io/go-dependency-force-layout/pipeline-dependencies.html?u=http://mrmanc.github.io/go-dependency-force-layout/examples/27012014.json">Here is a link to an example built from our pipeline definitions.</a><p/>

<h2>
<a name="whats-next" class="anchor" href="#whats-next"><span class="octicon octicon-link"></span></a>What's next?</h2>

<p>⊠ Specify XML location in parameter<br>
⊠ Add code to allow Cross Origin Resource Sharing<br>
⊠ Add arrowheads to indicate direction of dependency<br>
⊠ ‘Compiled’ graphs with data in the URL (like <a href="https://www.websequencediagrams.com/">Web Sequence Diagrams</a>) to allow you to share without leaking config<br>
⊠ Compress compiled dependency data to shorten the URL<br>
⊠ Hiding of labels for sharing<br>
⊠ Provide obfuscated realistic example to play with<br>
⊠ Use GitHub Pages to host the HTML file<br>
⊠ Allow user to generate a graph based on pasted in XML<br>
◻ Allow user to copy / save generated JSON to share with others<br>
◻ Allow user to open generated JSON pasted in<br>
◻ Replace ugly URL parsing with a decent library<br>
◻ Fix bug where you can ‘show’ labels on a shared chart with no labels<br>
◻ Links to pipelines from nodes<br>
◻ Bendy connectors like <a href="http://bl.ocks.org/GerHobbelt/3104394">this D3.js example</a><br>
◻ Test Cross Origin Resource Sharing on a real Go server<br>
◻ Improve my butt ugly procedural JavaScript<br>
◻ Error messages when the graph fails to load<br>
◻ Super secret cool next idea  </p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Go-dependency-force-layout maintained by <a href="https://github.com/mrmanc">mrmanc</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48554826-1', 'mrmanc.github.io');
  ga('send', 'pageview');

</script>
  </body>
</html>
